<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Internet of Things</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">
    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
    <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
</head>

<body>
    <div class="reveal">
        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section>
                <figure>
                    <h2 class="intro">Internet of Things</h2 class="intro">
                    <h2 class="intro">Internet of Things</h2 class="intro">
                    <h2 class="intro">Internet of Things</h2 class="intro">
                    <h2 class="intro">Internet of Things</h2 class="intro">
                </figure>
            </section>

            <section data-background="img/72-points-mesh.svg" data-background-transition="zoom">
                <p><b>Slides are here: <br>http://mhellar.github.io/physcomp2/3</b></p>
                <br>
                <p><b>Grab the code here: <br><a href="http://bit.ly/2s6rk1T">http://bit.ly/2s6rk1T</a></b></p>
            </section>


            <section>
                <ul>
                    <h3>Topics for Today:</h3>
                    <li class="fragment">Introduction to MQTT</li>
                    <li class="fragment">ESP32 Wireless communication with the ESP32</li>
                </ul>
            </section>
            <section>
                <img src="img/feather32.jpg">
            </section>
            <section>
                    <p>MQTT is a machine-to-machine (M2M)/"Internet of Things" connectivity protocol. It was designed as an extremely lightweight publish/subscribe messaging transport. It is useful for connections with remote locations where a small code footprint is required and/or network bandwidth is at a premium. For example, it has been used in sensors communicating to a broker via satellite link, over occasional dial-up connections with healthcare providers, and in a range of home automation and small device scenarios. It is also ideal for mobile applications because of its small size, low power usage, minimised data packets, and efficient distribution of information to one or many receivers</p>
                </section>
            <section>
            <section>
                    <p>MQTT</p>
                    <img src="img/mqtt.jpeg">
                </section>
                <section>
                        <p>Installing a broker</p>
                        <ul>
                            <li>Open a terminal</li>
                            <li>Type 'sudo npm install mosca pino -g' (windows users no sudo)</li>
                            <li>Type 'mosca -v | pino'</li>
                            <li>Leave this terminal open, this is the 'Broker'</li>
                        </ul>
                </section>
                <section>
                        <p>Installing a client</p>
                        <ul>
                            <li>Open a second terminal</li>
                            <li>Type 'sudo npm install mqtt -g' (windows users no sudo)</li>
                            <li>This installs the client tools</li>
                            <li>mqtt sub -t 'hello' -h 'localhost'</li>
                            <li>Leave this window open</li>
                        </ul>
                </section>
                <section>
                        <p>Installing a client</p>
                        <ul>
                            <li>Open a third terminal</li>
                            <li>mqtt pub -t 'hello' -h 'localhost' -m 'Hi from me'</li>
                        </ul>
                </section>
                <section>
                        <ul>
                            <li class="fragment">mqtt sub -t 'hello' -h 'localhost'</li>
                            <li class="fragment">'mqtt sub' means we are subscribing</li>
                            <li class="fragment">-t 'hello' indicates topic we are subscribing to</li>
                            <li class="fragment">It's like the name of a chat room</li>
                            <li class="fragment">We can choose any topic name, someone just has to publish to it</li>
                            <li class="fragment">-h 'localhost' indicates the host which is our local computer that is running the broker</li>
                        </ul>
                </section>
                <section>
                        <ul>
                        <li class="fragment">mqtt pub -t 'hello' -h 'localhost' -m 'Hi from me'</li>
                        <li class="fragment">'mqtt pub' means we are publishing</li>
                        <li class="fragment">-t 'hello' indicates topic we are publishing to</li>
                        <li class="fragment">-h 'localhost' indicates the host which is our local computer that is running the broker</li>
                        <li class="fragment">-m 'Hi from me' is the message we are sending</li>
                    </ul>
            </section>
            <section>
                    <p>The ESP32 can speak MQTT</p>
                    <img src="img/feather32.jpg">
            </section>
            <section>
                    <p>Open Arduino and go to the Library Manager</p>
                    <img src="img/libmgr.png">
            </section>
            <section>
                    <p>Search for PubSubClient and install</p>
                    <img src="img/pubsub.png">
            </section>
            <section>
                    <ul>
                    <li class="fragment">Make sure your laptop in on the BOTT network, password: iotpassword</li>
                    <li class="fragment">open mqtt_esp32 from the code folder</li>
                    <li class="fragment">Find you IP address, Mac Alt + Click on the wifi icon</li>
                    <li class="fragment">Windows type ipconfig /all at the terminal</li>
                    <li class="fragment">enter that on line 9</li>
                    <li class="fragment">Upload to the ESP32, make sure to set the board and port</li>
                    <li class="fragment">Check the output in the subscribe terminal</li>
                    <li class="fragment">See lines 93-100 of the code</li>
                </ul>
           </section>
           <section>
               <ul>
                   <li class="fragment">In the publish terminal type:</li>
                   <li class="fragment">mqtt pub -t 'inTopic' -h 'localhost' -m '0'</li>
                   <li class="fragment">This will turn the onboard LED on</li>
                   <li class="fragment">mqtt pub -t 'inTopic' -h 'localhost' -m '1'</li>
                   <li class="fragment">This will turn the onboard LED off</li>
                   <li class="fragment">See lines 55-62 of the code</li>
            </ul>
          </section>
          <section>
                <p>Hook Up the ADXL345 to the ESP32 3.3 -> 3v,GND -> GND,SDA->SDA,SCL->SCL</p>
                <img src="img/32345.png">
        </section>
        <section>
                    <ul>
                        <li>Make Usre you have the followin libraries installed</li>
                        <li>Adafruit_ADXL34</li>
                        <li>Adafruit Unified Sensor</li>
                        <li>Open mqtt_esp32_adxl345</li>
                        <li>Set the IP on Line 15</li>
                        <li>Upload</li>
                    </ul>
        </section>
    
        <section>
                <ul>
                    <li>MQTT with NodeJS</li>
                </ul>
    </section>

        </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
        // Full list of configuration options available at:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            transition: 'convex', // none/fade/slide/convex/concave/zoom

            // Optional reveal.js plugins
            dependencies: [{
                src: 'lib/js/classList.js',
                condition: function() {
                    return !document.body.classList;
                }
            }, {
                src: 'plugin/markdown/marked.js',
                condition: function() {
                    return !!document.querySelector('[data-markdown]');
                }
            }, {
                src: 'plugin/markdown/markdown.js',
                condition: function() {
                    return !!document.querySelector('[data-markdown]');
                }
            }, {
                src: 'plugin/highlight/highlight.js',
                async: true,
                condition: function() {
                    return !!document.querySelector('pre code');
                },
                callback: function() {
                    hljs.initHighlightingOnLoad();
                }
            }, {
                src: 'plugin/zoom-js/zoom.js',
                async: true
            }, {
                src: 'plugin/notes/notes.js',
                async: true
            }]
        });
    </script>
</body>

</html>